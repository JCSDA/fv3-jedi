cost function:
  cost type: 3D-Var
  window begin: 2019-01-02T00:00:00Z
  window length: PT6H
  analysis variables: [no2] # long name needs to be changed
  geometry:
    fms initialization:
      namelist filename: Data/fv3files/fmsmpp.nml
    akbk: Data/fv3files/akbk72.nc4
    npx: 13
    npy: 13
    npz: 72
    fieldsets:
    - fieldset: Data/fieldsets/chemistry_geos.yaml
    - fieldset: Data/fieldsets/dynamics.yaml
    - fieldset: Data/fieldsets/ufo.yaml
  background:
    datetime: 2019-01-02T03:00:00Z
    filetype: cube sphere history
    datapath: Data/inputs/geos_c12
    filename: geos.cf.bkg.%yyyy%mm%dd_%hh%MM%ssz.nc4
    state variables: [DELP,NO2,NO,O3,PS,SPHU]

  background error:
    covariance model: SABER
    saber blocks:
    - saber block name: BUMP_NICAS
      saber central block: true
      iterative inverse: true
      input variables: [no2]
      output variables: [no2]
      bump:
        prefix: Data/bump/fv3jedi_bumpparameters_nicas_3D_geos-cf
        method: cor
        strategy: specific_univariate
        load_nicas_local: true
        verbosity: main
        io_keys: [no2-no2]
        io_values: [fixed_2500km_0.3]
    - saber block name: StdDev
      input variables: [no2]
      output variables: [no2]
      file:
        datetime: 2019-01-02T00:00:00Z
        set datetime on read: true
        filetype: cube sphere history
        datapath: Data/inputs/geos_c12
        filename: geos.cf.stddev.nox_50_o3_25.nc4

  observations:
  - obs space:
      name: NO2
      obsdatain:
        obsfile: Data/obs/testinput_tier_1/tropomi_no2_2019010200_m.nc4
      obsdataout:
        obsfile: Data/hofx/tropomi_no2_hofx_geos_2019010200_m.nc
      simulated variables: [nitrogen_dioxide_in_tropospheric_column]
    obs operator:
      name: AvgKernel
      nlayers_kernel: 34
      PresLevVar: pressure_level
      AvgKernelVar: averaging_kernel_level
      tracer variables: [no2]
      tropospheric column: true
      total column: false
      model units coeff: 1.0 # geoscf already in ppmv
    obs error:
      covariance model: diagonal

final:
  diagnostics:
    departures: oman
output:
  filetype: cube sphere history
  provider: geos
  datapath: Data/analysis
  filename: geos.cf.3dvar_ana.%yyyy%mm%dd_%hh%MM%ssz.nc4
  first: PT0H
  frequency: PT6H
variational:
  minimizer:
    algorithm: DRIPCG
  iterations:
  - ninner: 10
    gradient norm reduction: 1e-10
    test: on
    geometry:
      akbk: Data/fv3files/akbk72.nc4
      npx: 13
      npy: 13
      npz: 72
      fieldsets:
      - fieldset: Data/fieldsets/chemistry_geos.yaml
      - fieldset: Data/fieldsets/dynamics.yaml
      - fieldset: Data/fieldsets/ufo.yaml
    diagnostics:
      departures: ombg

test:
  reference filename: testoutput/3dvar_geos-cf.ref
  test output filename: testoutput/3dvar_geos-cf.test.out
  integer tolerance: 3
  float relative tolerance: 1.0e-0
